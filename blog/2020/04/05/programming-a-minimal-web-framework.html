<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=0.5">
  <title>Programming a minimal web framework</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<style>
  body {
    margin: auto 0;
  }

  .button {
    border-radius: 2em !important;
  }
  @media (min-width: 768px) {
    .container {
      margin: 0 auto;
      width: 800px;
      font-size: 16px;
      line-height: 130%;
    }  
  }
  
  .header {
    width:100%;
    background-color: black;
    padding: 15px 5px;
    color: white;
  }
  div.sourceCode {
    padding-left: 4px;
    border-left: 2px solid black;
  }
  ul.nav {
    display: inline-flex;
    list-style-type: none;
  }
  ul.nav li {
    margin-left: 12px;  
  }
  ul.nav li a {
    text-decoration: none;
    color: white;
  }
  code {
    font-size: 14px;
    font-weight: 600;
  }
  </style>
</head>
<body>
<div class="header">
  Trshant's Rambling
  <ul class="nav" >
    <li><a href="/archive.html">Archives</a></li>
    <li><a href="/resume.pdf">Resume</a></li>
    <li><a href="/recipes.html">Recipes</a></li>
  </ul>
</div>

<div class="container">
<header>
<h1 class="title">Programming a minimal web framework</h1>

  <a class="button button-small" href="javascript: void(0)">blog</a>
  <a class="button button-small" href="javascript: void(0)">programming</a>
  <a class="button button-small" href="javascript: void(0)">python</a>
  <a class="button button-small" href="javascript: void(0)">softwareEngineering</a>
  <a class="button button-small" href="javascript: void(0)">webDevelopment</a>


</header>
<h1 id="programming-a-minimal-web-framework">Programming a minimal web framework</h1>
<p>This was a proof of concept I wanted to program to see for myself how web frameworks worked &quot;under the hood&quot;. While production-ready web frameworks are a lot more sophisticated than this, i wanted to strip the functionality to the barest minimum and use that to understand the concepts involved.</p>
<p>A web framework is a careful mix of decorators, the TCP server module and some class magic. While some of the web frameworks will expressed differently in code ( backwards compatibility, python version, robustness ) , I have chosen to use newer modules because this will never be in production.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer # python2</span>
<span class="im">from</span> http.server <span class="im">import</span> BaseHTTPRequestHandler, HTTPServer <span class="co"># python3</span></code></pre></div>
<p><code>BaseHTTPRequestHandler</code> is the main class around which we will build our minimal web framework. We also inherit the function signifiers to decide how we are going to respond to all kinds of REST requests. Since this is going to be minimal, i have decided to only include GET and POST in my framework.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="kw">class</span> HandleRequests(BaseHTTPRequestHandler):
    <span class="kw">def</span> _set_headers(<span class="va">self</span>):
        <span class="va">self</span>.send_response(<span class="dv">200</span>)
        <span class="va">self</span>.send_header(<span class="st">&#39;Content-type&#39;</span>, <span class="st">&#39;text/html&#39;</span>)
        <span class="va">self</span>.end_headers()

    <span class="kw">def</span> do_GET(<span class="va">self</span>):
        <span class="co">&#39;&#39;&#39;Reads GET request body&#39;&#39;&#39;</span>
        <span class="va">self</span>._set_headers()
        stringToReturn <span class="op">=</span> app.handleRoutes(<span class="va">self</span>.path , <span class="st">&quot;POST&quot;</span> )
        <span class="va">self</span>.wfile.write( <span class="bu">str</span>.encode(stringToReturn) )
        
    <span class="kw">def</span> do_POST(<span class="va">self</span>):
        <span class="co">&#39;&#39;&#39;Reads POST request body&#39;&#39;&#39;</span>
        <span class="va">self</span>._set_headers()
        stringToReturn <span class="op">=</span> app.handleRoutes(<span class="va">self</span>.path , <span class="st">&quot;GET&quot;</span> )
        <span class="va">self</span>.wfile.write( <span class="bu">str</span>.encode(stringToReturn) )</code></pre></div>
<p>See the code above. For simplicity's sake, I have decided that all responses headers are going to have the mime &quot;text/html&quot;.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">
<span class="kw">class</span> app:
    <span class="at">@staticmethod</span>
    <span class="kw">def</span> run(host,port):
        HTTPServer((host, port), HandleRequests).serve_forever()        
    
    routes       <span class="op">=</span>  []
    routes_path  <span class="op">=</span>  {}</code></pre></div>
<p>The main function, which sets the hostname and port.</p>
<div class="sourceCode"><pre class="sourceCode py"><code class="sourceCode python">    <span class="at">@classmethod</span>
    <span class="kw">def</span> route( <span class="va">self</span>, path):
        <span class="va">self</span>.routes.append(path)
        <span class="kw">def</span> tags_decorator(func):
            <span class="va">self</span>.routes_path[path] <span class="op">=</span> func
            <span class="kw">def</span> func_wrapper():
                <span class="cf">return</span> func()
            <span class="cf">return</span> func_wrapper
        <span class="cf">return</span> tags_decorator</code></pre></div>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">    <span class="at">@classmethod</span>
    <span class="kw">def</span> handleRoutes( <span class="va">self</span>, path, method ):
        stringToReturn  <span class="op">=</span> <span class="st">&quot;recieved &quot;</span><span class="op">+</span>method<span class="op">+</span><span class="st">&quot;request : &quot;</span>
        stringToReturn <span class="op">+=</span> <span class="va">self</span>.routes_path[path]()
        <span class="cf">return</span> stringToReturn
 </code></pre></div>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="at">@app.route</span>(<span class="st">&quot;/&quot;</span>)
<span class="kw">def</span> get_text():
    <span class="cf">return</span> <span class="st">&quot;Hello &quot;</span>

<span class="at">@app.route</span>(<span class="st">&quot;/name/&quot;</span>)
<span class="kw">def</span> get_text2():
    <span class="cf">return</span> <span class="st">&quot;Hello 2&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">host <span class="op">=</span> <span class="st">&#39;&#39;</span>
port <span class="op">=</span> <span class="dv">80</span>
app.run(host, port)</code></pre></div>
<p>Download the entire file using the <a href="https://gist.github.com/Trshant/bf317e55069acd5746ed222ac8f878f6">gist</a>.</p>
<p><a href="https://www.thecodeship.com/patterns/guide-to-python-function-decorators/">function decorators</a><br />
<a href="http://bottlepy.org/docs/dev/">bottle website</a> <a href="https://raw.githubusercontent.com/bottlepy/bottle/master/bottle.py">bottle code</a></p>
<p>Going forward, knowing the expressiveness of the python language, we can add databases and program it to return various server statuses and also use a database and templating system.</p>
<link rel="stylesheet" href="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.css">
<script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
</div>
</body>
</html>
